<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.support.movement.AdminDAO">

	
	<!-- 관리자 로그인 아이디 갯수 -->
	<select id="getAcceptPermit" parameterType="String" resultType="int">
		select count(*) from admin where admin_id=#{id}
	</select>
	
	<select id="getAcceptListAllCnt" resultType="int">
		select count(*) from driver where admission_code='n'
	</select>
	
	<select id="getAcceptList" resultType="hashmap">
		select
            driver_no||'' as "driver_no", 
             driver_name as "driver_name", 
             driver_id as "driver_id", 
             driver_pwd as "driver_pwd", 
             driver_gender as "driver_gender", 
             driver_jumin_num as "driver_jumin_num", 
             driver_postal_code||'' as "driver_postal_code", 
             driver_road_addr as "driver_road_addr", 
             driver_jibun_addr as "driver_jibun_addr", 
             driver_detail_addr as "driver_detail_addr", 
             driver_phone as "driver_phone",  
             driver_email as "driver_email",  
             driver_license_number as "driver_license_number", 
             to_char(driver_reg_date,'YYYY-MM-DD') "driver_reg_date"
              
         from driver
         where admission_code='n' 
		
	</select>
	
	
	<select id="getDriverUpDelListAllCnt" resultType="int">
		select count(*) from driver where admission_code='y'
	</select>
	
	<select id="getUserUpDelListAllCnt" resultType="int">
		select count(*) from disability_user where admission_code='y'
	</select>
	
	<select id="getDriverUpDelList" resultType="hashmap">
		select
            driver_no||'' as "driver_no", 
             driver_name as "driver_name", 
             driver_id as "driver_id", 
             driver_pwd as "driver_pwd", 
             driver_gender as "driver_gender", 
             driver_jumin_num as "driver_jumin_num", 
             driver_postal_code||'' as "driver_postal_code", 
             driver_road_addr as "driver_road_addr", 
             driver_jibun_addr as "driver_jibun_addr", 
             driver_detail_addr as "driver_detail_addr", 
             driver_phone as "driver_phone",  
             driver_email as "driver_email",  
             driver_license_number as "driver_license_number", 
             to_char(driver_reg_date,'YYYY-MM-DD') "driver_reg_date"
              
         from driver
         where admission_code='y' 
		
	</select>
	
	
	<select id="getUserUpDelList" resultType="hashmap">
		select
            user_no||'' as "user_no", 
             user_name as "user_name", 
             user_id as "user_id", 
             user_pwd as "user_pwd", 
             user_gender as "user_gender", 
             user_jumin_num as "user_jumin_num", 
             user_postal_code||'' as "user_postal_code", 
             user_road_addr as "user_road_addr", 
             user_jibun_addr as "user_jibun_addr", 
             user_detail_addr as "user_detail_addr", 
             user_phone as "user_phone",  
             user_email as "user_email",
             disability_grade_code as "disability_grade_code",
             disability_type_code as "disability_type_code",
             wheelchair as "wheelchair",
             to_char(user_reg_date,'YYYY-MM-DD') "user_reg_date"
              
         from disability_user
         where admission_code='y' 
		
	</select>
	
	<update id="getAcceptDriverCnt" parameterType="int">
		update driver 
		set admission_code='y'
		where driver_no=#{driver} 
	</update>
	
	
	<insert id="getDriverRegCnt" parameterType="com.support.movement.DriverDTO">
	insert into driver(
		driver_no,
		driver_id,
		driver_pwd,
		driver_name,
		driver_gender,
		driver_jumin_num,
		driver_postal_code,
		driver_road_addr,
		driver_jibun_addr,
		driver_detail_addr,
		driver_phone,
		driver_email,
		driver_license_number,
		admission_code
		
	) values (
	(select nvl(max(driver_no),0)+1 from driver), 
	#{id},
	#{pwd1},
	#{name},
	#{gender},
	'${jumin_num1}${jumin_num2}',
	#{postal_code},
	#{road_addr},
	#{jibun_addr},
	#{detail_addr},
	#{phone},
	#{email},
	#{driver_license_number},
	#{admission_code}
	
	)
			
	</insert>
	
	
	<select id= "getDriverDTO" parameterType="int" resultType="com.support.movement.DriverDTO">
		select
			driver_no||'' as "driver_no",
			driver_id as "id",
			driver_pwd as "pwd1",
			driver_name as "name",
			driver_gender as "gender",
			substr(driver_jumin_num,1,6) as "jumin_num1",
			substr(driver_jumin_num,7,7) as "jumin_num2",
			driver_postal_code||'' as "postal_code",
			driver_road_addr as "road_addr",
			driver_jibun_addr as "jibun_addr",
			driver_detail_addr as "detail_addr",
			driver_phone as "phone",
			driver_email as "email",
			driver_license_number as "driver_license_number",
			admission_code as "admission_code"
			
			from driver
			where driver_no = #{driver_no}
			 
			
	</select>
	<update id="getCarDriverDelCnt" parameterType="com.support.movement.DriverDTO">
		update car_info 
		set car_driver=''
		where car_driver=#{driver_no} 
	</update>
	
	<update id="getDriverDelCnt" parameterType="com.support.movement.DriverDTO">
		update driver
		set admission_code='d'
		where driver_no=${driver_no}
	</update>
	<update id="getDriverUpCnt" parameterType="com.support.movement.DriverDTO">
		update driver
		set 
			driver_id = #{id},
			driver_pwd = #{pwd1},
			driver_name=#{name},
			driver_gender=#{gender},
			driver_jumin_num='${jumin_num1}${jumin_num2}',
			driver_postal_code=${postal_code},
			driver_road_addr=#{road_addr},
			driver_jibun_addr=#{jibun_addr},
			driver_detail_addr=#{detail_addr},
			driver_phone = #{phone},
			driver_email =#{email},
			driver_license_number =#{driver_license_number}
		where driver_no=${driver_no}
	</update>
	
	
	<insert id="getUserRegCnt" parameterType="com.support.movement.UserDTO">
   insert into disability_user(
      user_no,
      user_id,
      user_pwd,
      user_name,
      user_gender,
      user_jumin_num,
      user_postal_code,
      user_road_addr,
      user_jibun_addr,
      user_detail_addr,
      user_phone,
      user_email,
      disability_grade_code,
      disability_type_code,
      wheelchair
   ) values (
   (select nvl(max(user_no),0)+1 from disability_user), 
   #{id},
   #{pwd1},
   #{name},
   #{gender},
   '${jumin_num1}${jumin_num2}',
   #{postal_code},
   #{road_addr},
   #{jibun_addr},
   #{detail_addr},
   #{phone},
   #{email},
   ${disability_type},
   ${disability_grade},
   ${wheelchair}
   )
         
   </insert>
   
   
   <select id= "getUserDTO" parameterType="int" resultType="com.support.movement.UserDTO">
		select
			user_no||'' as "user_no",
			user_id as "id",
			user_pwd as "pwd1",
			user_name as "name",
			user_gender as "gender",
			substr(user_jumin_num,1,6) as "jumin_num1",
			substr(user_jumin_num,7,7) as "jumin_num2",
			user_postal_code||'' as "postal_code",
			user_road_addr as "road_addr",
			user_jibun_addr as "jibun_addr",
			user_detail_addr as "detail_addr",
			user_phone as "phone",
			user_email as "email",
			disability_grade_code "disability_grade",
			disability_type_code "disability_type",
			wheelchair "wheelchair",
			admission_code as "admission_code"
			
			from disability_user
			where user_no = #{user_no}
			 
	</select>
	
	
	 <update id="getUserDelCnt" parameterType="com.support.movement.UserDTO">
      update disability_user
      set admission_code='d'
      where user_no=${user_no}
   </update>
   <update id="getUserUpCnt" parameterType="com.support.movement.UserDTO">
      update disability_user
      set 
         user_id = #{id},
         user_pwd = #{pwd1},
         user_name = #{name},
         user_gender = #{gender},
         user_jumin_num = '${jumin_num1}${jumin_num2}',
         user_postal_code = ${postal_code},
         user_road_addr = #{road_addr},
         user_jibun_addr = #{jibun_addr},
         user_detail_addr = #{detail_addr},
         user_phone = #{phone},
         user_email = #{email},
         disability_type_code = ${disability_type},
         disability_grade_code = ${disability_grade},
         wheelchair = ${wheelchair}
      where user_no=${user_no}
      
   </update>
	
	
	<!-- ==================등록된 드라이버 리스트(차량등록된운전자제외) ==========================-->
	<select id="getDriverList" resultType="hashmap">
		select 
            driver_name as "driver_name",
            driver_no||'' as "driver_no"
        from driver 
        where admission_code='y'  
              and driver_no not IN(select car_driver from car_info)
	</select>
	
	<!-- ============================차량 등록(운전자이름을 운전자넘버로)==============================-->
	<insert id="getCarRegCnt" parameterType="com.support.movement.CarDTO">
		insert into car_info(
			car_info_no
			, car_number
			, car_year
			, car_distance
			, car_code
			, car_driver
		) values (
			(select nvl(max(car_info_no),0)+1 from car_info)
			, #{car_number}
			, #{car_year}
			, #{car_distance}
			, #{car_code}
			, #{car_driver}
		)
	</insert>
	
	
	
	<!-- ============================차량총개수==============================-->
	<select id="getCarListAllCnt" resultType="int">
		select count(*) from car_info
	</select>
	
	<!-- ============================차량리스트==============================-->
	<select id="getCarList" resultType="hashmap">
		select
			ci.car_info_no||'' as "car_info_no"
			, ci.car_number||'' as "car_number"
			, ci.car_year||'' as "car_year"
			, ci.car_distance||'' "car_distance"
			, (select car_type from code_car cc where cc.car_code=ci.car_code) as "car_code"
			, ci.car_driver||'' as "car_driver"
			, ci.car_reg_date||'' as "car_reg_date"
		from car_info ci 
		where 1=1
		
	</select>
	
	<!-- ============================차량상세보기==============================-->
	<select id="getCarDTO" parameterType="int" resultType="com.support.movement.CarDTO">
		select
			car_info_no||'' as "car_info_no"
			, car_number||'' as "car_number"
			, car_year||'' as "car_year"
			, car_distance||'' "car_distance"
			, car_code||'' as "car_code"
			, car_driver||'' as "driver_no"
			, (select d.DRIVER_NAME||'' from driver d, car_info c where d.DRIVER_NO=c.CAR_DRIVER and c.CAR_INFO_NO=#{car_info_no})||'' as "car_driver"
		from car_info
		where car_info_no=#{car_info_no}
		
	</select>
	
	<!-- ============================차량정보수정==============================-->
	<update id="getCarUpdateCnt" parameterType="com.support.movement.CarDTO">
		update car_info set
		    car_number = #{car_number}
		 	, car_year = ${car_year}
		 	, car_distance = ${car_distance}
		 	, car_code = ${car_code}
		 	, car_driver = #{car_driver}
		where car_info_no=#{car_info_no}		
	</update>
	
	<!-- ============================차량정보삭제==============================-->
	<delete id="getCarDeleteCnt" parameterType="int">
		delete from car_info
		where car_info_no=#{car_info_no}
	</delete>
	
	
	<!-- ============================차량정비등록==============================-->
	<insert id="getCarMaintanceRegCnt" parameterType="com.support.movement.CarMaintanceDTO">
		insert into car_maintance_info (
			car_maintance_info_no
			, car_number
			, car_maintance_date
			, car_maintance_code
			, car_maintance_content
		) values (
			(select nvl(max(car_maintance_info_no),0)+1 from car_maintance_info)
			, #{car_number}
			, to_date(#{car_maintance_date},'YYYYMMDD')
			, ${car_maintance_code}
			, #{car_maintance_content}
		)	
	</insert>
	
	<!-- ============================차량정비수정삭제(리스트 개수)==============================-->
	<select id="getCarMaintanceListAllCnt" resultType="int">
		select count(*) from car_maintance_info	
	</select>
	
	<!-- ============================차량정비수정삭제(리스트)==============================-->
	<select id="getCarMaintanceList" resultType="hashmap">
		select
			car_maintance_info_no||'' as "car_maintance_info_no"
			, car_number||'' as "car_number"
			, car_maintance_date||'' as "car_maintance_date"
		from car_maintance_info	
	</select>
	
	<!-- ============================차량정비수정삭제(상세보기)==============================-->
	<select id="getCarMaintanceDTO" parameterType="int" resultType="com.support.movement.CarMaintanceDTO">
		select
			car_maintance_info_no||'' as "car_maintance_info_no"
			, car_number||'' as "car_number"
			, to_char(car_maintance_date,'YYYYMMDD')||'' as "car_maintance_date"
			, car_maintance_code||'' as "car_maintance_code"
			, car_maintance_content||'' as "car_maintance_content"
		from car_maintance_info	 
		where car_maintance_info_no=#{car_maintance_info_no}
	</select>
	
	<!-- ============================차량 정비내용 정보 수정==============================-->
	<update id="getCarMaintanceUpdateCnt" parameterType="com.support.movement.CarMaintanceDTO">
		update car_maintance_info set			
		    car_number = #{car_number}
		 	, car_maintance_date = to_date(#{car_maintance_date},'YYYYMMDD')
		 	, car_maintance_code = ${car_maintance_code}
		 	, car_maintance_content = #{car_maintance_content}
		where car_maintance_info_no=#{car_maintance_info_no}		
	</update>
	<!-- ============================차량 정비내용 정보 삭제==============================-->
	<delete id="getCarMaintancDeleteCnt" parameterType="int">
		delete from car_maintance_info
		where car_maintance_info_no=#{car_maintance_info_no}
	</delete>
	
	<select id="getQnaList"  parameterType="int" resultType="java.util.HashMap">
		select
			question_no||''		as "question_no"
			, question_subject	as "question_subject"	
			, question_content		as "question_content"
			, question_group_no		as "question_group_no"
			, question_print_no		as "question_print_no"
		from question
		where
		 question_group_no = #{question_group_no}
		 
	</select>
	
	<!-- QnA  게시판에 글쓰기 입력하는 insert태그 -->
	<insert id="insertQna" parameterType="com.support.movement.QnaDTO">
		insert into question(
			question_no
			, question_subject
			, question_content
			, question_group_no
			, question_print_no
		) values(
			(select nvl(max(question_no), 0) + 1 from question) 
			, #{subject}
			, #{content}
			, ${question_group_no} 
			, 0
		)
	</insert>
	
	<select id= "getQnaDTO" parameterType="int" resultType="com.support.movement.QnaDTO">
		select
			question_no||''		as "question_no"
			, question_subject	as "subject"	
			, question_content		as "content"
			, question_group_no		as "question_group_no"
			, question_print_no		as "question_print_no"
		from question
		where
		 question_no = #{question_no}
	</select>
	
	
	<update id = "updateQna" parameterType = "com.support.movement.QnaDTO">
      update question
      set 
      	question_subject = #{subject}
          , question_content = #{content}
      where 
      	question_no = #{question_no}
   </update>
	
	
	<delete id = "deleteQna" parameterType = "com.support.movement.QnaDTO">
      delete from question		where question_no =  #{question_no}
   </delete>
	
	<select id="getBoardCnt"	parameterType = "com.support.movement.QnaDTO"	 resultType="int">
   		select 	count(*)	from question		where question_no = #{question_no}
   </select>
</mapper>
